<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dispatch System Dashboard</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        /* General Body Styling */
        body {
            margin: 0;
            padding: 0;
            font-family: 'Roboto', sans-serif;
            background-color: #1a1a2e; /* Dark background */
            color: #e0e0e0; /* Light text color */
            display: flex;
            flex-direction: column;
            height: 100vh; /* Full viewport height */
            overflow: hidden; /* Prevent body scroll, content will scroll if needed */
            position: relative; /* Needed for absolute positioning of top-corner elements and loading overlay */
        }

        /* Initial display state: Dashboard elements hidden by default */
        .dashboard-container, .top-left-logo, .top-right-info, #menuBar {
            display: none; /* These will be shown after successful login */
        }

        /* Top-Corner Elements */
        .top-left-logo {
            position: absolute;
            top: 10px;
            left: 10px;
            width: 50px; /* Adjust size as needed */
            height: auto;
            z-index: 100; /* Ensure it's on top */
            border-radius: 5px; /* Optional: rounded corners for the image */
        }

        .top-right-info {
            position: absolute;
            top: 10px;
            right: 10px;
            z-index: 100;
            display: flex; /* To stack version and countdown */
            flex-direction: column;
            align-items: flex-end; /* Align text to the right */
            gap: 5px; /* Space between version and countdown */
        }

        .top-right-version {
            font-size: 0.8em;
            color: #90a0c0;
        }

        .top-right-countdown {
            font-size: 0.9em;
            font-weight: 500;
            color: #ffcc00; /* Yellow for update countdown */
        }

        /* Menu Bar Styling */
        #menuBar {
            display: flex;
            justify-content: flex-start; /* Align items to the start (left) */
            background-color: #2a2a4a; /* Darker header */
            padding: 10px 15px;
            border-bottom: 1px solid #303050;
            gap: 10px; /* Space between menu items */
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            box-sizing: border-box; /* Include padding in width */
            z-index: 90; /* Below top-corner info but above dashboard */
            padding-left: 70px; /* To make space for the logo */
        }

        #menuBar button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9em;
            font-weight: 500;
            transition: background-color 0.2s ease;
        }

        #menuBar button:hover {
            background-color: #0056b3;
        }


        /* Main Container for the entire dashboard */
        .dashboard-container {
            display: flex;
            flex-direction: column;
            flex-grow: 1;
            padding: 10px;
            gap: 10px; /* Space between top and bottom sections */
            /* Add padding to prevent content from being hidden by top-corner elements */
            padding-top: 60px; /* Adjust based on logo/version height + desired spacing */
        }

        /* Top Section Layout - Adjusted to accommodate 3 columns */
        .top-section {
            display: flex;
            gap: 10px;
            flex-grow: 1; /* Allows it to take available space */
            min-height: 0; /* Important for flex items with scrollable children */
        }

        /* Panels in Top Section */
        .top-panel-left, .top-panel-middle, .top-panel-right { /* Added top-panel-middle */
            background-color: #20203a; /* Slightly lighter dark blue */
            border-radius: 8px;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        /* Flex distribution for top panels */
        .top-panel-left { /* Active Calls */
            flex: 4; /* Larger for the main call list */
        }
        .top-panel-middle { /* Active Units */
            flex: 1.5; /* Slightly larger than BOLO, but smaller than calls */
        }
        .top-panel-right { /* Active BOLOs */
            flex: 1.5; /* Dedicated space for BOLOs */
        }


        .panel-header {
            background-color: #2a2a4a; /* Darker header */
            padding: 10px 15px;
            font-size: 0.9em;
            font-weight: 500;
            color: #90a0c0; /* Lighter blue for headers */
            border-bottom: 1px solid #303050;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .panel-content {
            flex-grow: 1;
            overflow-y: auto; /* Enable vertical scrolling for content */
            padding: 0 5px; /* Padding for content, adjust as needed */
        }

        /* Table/List Styling for Top Left Panel (Active Calls) */
        .data-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.85em;
        }

        .data-table th, .data-table td {
            padding: 8px 10px;
            text-align: left;
            border-bottom: 1px solid #282848; /* Lighter border for rows */
            white-space: nowrap; /* Prevent text wrapping */
            overflow: hidden;
            text-overflow: ellipsis; /* Add ellipsis for overflow */
        }

        .data-table th {
            background-color: #252545;
            font-weight: 400;
            color: #a0b0d0;
            position: sticky; /* Sticky headers for scrolling */
            top: 0;
            z-index: 1;
        }

        .data-table tr {
            cursor: pointer; /* Indicate rows are clickable/selectable */
        }

        .data-table tr:hover {
            background-color: #28284f; /* Hover effect for rows */
        }

        .data-table tr.active-row {
            background-color: #3a3a7a; /* Highlight active row */
            color: #ffffff;
        }
        .data-table tr.active-row td {
            font-weight: 500; /* Make text bolder for active row */
        }

        /* Unit List (Active Units) */
        .unit-list {
            padding: 10px 0;
        }

        .unit-item {
            padding: 8px 15px;
            font-size: 0.9em;
            border-bottom: 1px solid #282848;
            cursor: pointer;
        }
        .unit-item:last-child {
            border-bottom: none;
        }
        .unit-item:hover {
            background-color: #28284f;
        }
        .unit-item.active {
            background-color: #304060; /* Blueish highlight for active unit */
            color: #ffffff;
            font-weight: 500;
        }
        .unit-item.active .unit-id {
            color: #fff; /* White for active unit ID */
        }
        .unit-item .unit-id {
            font-weight: 700;
            color: #70b0e0; /* Brighter blue for unit ID */
            margin-right: 5px;
        }

        /* BOLO List (Active BOLOs) */
        .bolo-list {
            padding: 10px 0;
        }

        .bolo-item {
            padding: 8px 15px;
            font-size: 0.9em;
            border-bottom: 1px solid #282848;
            cursor: pointer;
        }
        .bolo-item:last-child {
            border-bottom: none;
        }
        .bolo-item:hover {
            background-color: #28284f;
        }
        .bolo-item .bolo-id {
            font-weight: 700;
            color: #e0b070; /* Orangeish for BOLO ID */
            margin-right: 5px;
        }
        .bolo-item .bolo-time {
            font-size: 0.8em;
            color: #90a0c0;
            margin-left: 5px;
        }


        /* Bottom Section Layout (Yellow highlighted in image) */
        .bottom-section {
            display: flex;
            gap: 10px;
            flex-shrink: 0; /* Prevent it from shrinking */
            height: 350px; /* Fixed height as per image's proportion */
            border: 2px solid #ffcc00; /* Yellow border as in image */
            border-radius: 8px; /* Match panel radius */
            overflow: hidden; /* Ensure content stays within border */
            background-color: #20203a; /* Background for the entire bottom section */
        }

        /* Left Panel in Bottom Section (Forms) */
        .bottom-panel-left {
            flex: 1;
            padding: 15px;
            display: flex;
            flex-direction: column;
            gap: 20px; /* Space between form sections */
            border-right: 1px solid #303050; /* Separator between forms and details */
            overflow-y: auto; /* Allow scrolling if content overflows */
        }

        .bottom-panel-left .section-title {
            font-size: 1.1em;
            font-weight: 500;
            color: #e0e0e0;
            padding-bottom: 10px;
            border-bottom: 1px solid #303050;
            margin-bottom: 15px;
        }
        .bottom-panel-left .section-title span {
            color: #ffcc00; /* Yellow for section titles */
        }

        .form-group {
            margin-bottom: 10px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-size: 0.8em;
            color: #90a0c0;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: calc(100% - 20px); /* Adjust for padding */
            padding: 8px 10px;
            background-color: #303050; /* Darker input background */
            border: 1px solid #404060;
            border-radius: 4px;
            color: #e0e0e0;
            font-size: 0.9em;
        }
        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #6080ff; /* Blue highlight on focus */
            box-shadow: 0 0 0 2px rgba(96, 128, 255, 0.2);
        }

        textarea {
            resize: vertical; /* Allow vertical resizing */
            min-height: 60px;
        }

        .form-buttons {
            display: flex;
            gap: 10px;
            margin-top: 15px; /* Space above buttons */
            padding-top: 15px;
            border-top: 1px solid #303050;
        }
        .form-buttons button {
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 500;
        }
        .form-buttons .btn-primary {
            background-color: #007bff; /* Blue button */
            color: white;
        }
        .form-buttons .btn-secondary {
            background-color: #505070; /* Gray button */
            color: #e0e0e0;
        }
        .form-buttons .btn-primary:hover { background-color: #0056b3; }
        .form-buttons .btn-secondary:hover { background-color: #606080; }

        /* Specific Styling for form sections in bottom-panel-left */
        .unit-status-update-section .form-buttons,
        .new-bolo-section .form-buttons,
        .system-controls-section .form-buttons { /* Added system-controls */
            margin-top: 10px;
            border-top: none;
            padding-top: 0;
        }
        .unit-status-update-section .section-title,
        .new-bolo-section .section-title,
        .system-controls-section .section-title { /* Added system-controls */
            border-top: 1px solid #303050; /* Separator for these sections */
            padding-top: 20px;
            margin-top: 20px;
        }


        /* Right Panel in Bottom Section (e.g., Event Details) */
        .bottom-panel-right {
            flex: 1.5; /* Takes more space than left form */
            padding: 15px;
            overflow-y: auto; /* Allow scrolling for event details if long */
        }

        .detail-item {
            margin-bottom: 10px;
        }
        .detail-label {
            font-size: 0.8em;
            color: #90a0c0;
            margin-bottom: 3px;
            display: block;
        }
        .detail-value {
            font-size: 0.95em;
            color: #e0e0e0;
            font-weight: 400;
        }
        .detail-value.important {
            color: #ffcc00; /* Yellow for important values */
            font-weight: 500;
        }

        /* Utility/Helper Classes */
        .text-muted {
            color: #888;
        }
        .text-blue {
            color: #70b0e0;
        }
        .text-red {
            color: #e35d6a; /* A soft red */
        }
        .status-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.75em;
            font-weight: 500;
            text-transform: uppercase;
        }
        .status-badge.red {
            background-color: rgba(227, 93, 106, 0.2);
            color: #e35d6a;
        }
        .status-badge.green {
            background-color: rgba(144, 238, 144, 0.2);
            color: #90ee90;
        }
        .status-badge.blue {
            background-color: rgba(100, 149, 237, 0.2);
            color: #6495ed;
        }

        /* Scrollbar Styling (Webkit - Chrome, Safari, Edge) */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px; /* For horizontal scrollbars */
        }
        ::-webkit-scrollbar-track {
            background: #282848;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb {
            background: #404060;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #505070;
        }

        /* Custom Context Menu Styling */
        #customContextMenu {
            display: none; /* Hidden by default */
            position: absolute;
            background-color: #3a3a7a; /* Darker background for menu */
            border: 1px solid #4a4a8a;
            border-radius: 5px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.5);
            z-index: 1000; /* Ensure it's on top of everything */
            padding: 5px 0;
            min-width: 180px;
        }

        #customContextMenu .menu-item {
            padding: 8px 15px;
            cursor: pointer;
            font-size: 0.9em;
            color: #e0e0e0;
        }

        #customContextMenu .menu-item:hover {
            background-color: #4a4a8a; /* Hover effect for menu items */
        }

        /* Loading Overlay */
        #loadingOverlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8); /* Semi-transparent black */
            color: white;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 2em;
            z-index: 2000; /* Above everything else */
            transition: opacity 0.5s ease-out;
            opacity: 1;
        }
        #loadingOverlay.hidden {
            opacity: 0;
            pointer-events: none; /* Allows clicks to pass through when hidden */
        }

        /* Admin Panel Modal Styling */
        #adminPanelModal {
            display: none; /* Hidden by default */
            position: fixed;
            z-index: 2002; /* Above login and loading overlay */
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.7); /* Dark semi-transparent background */
            justify-content: center;
            align-items: center;
            animation: fadeIn 0.3s forwards;
        }

        .admin-panel-content {
            background-color: #20203a;
            margin: auto;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.5);
            width: 80%;
            max-width: 600px;
            position: relative;
            animation: slideIn 0.3s forwards;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .admin-panel-content h2 {
            color: #ffcc00;
            margin-top: 0;
            border-bottom: 1px solid #303050;
            padding-bottom: 15px;
            margin-bottom: 20px;
        }

        .admin-panel-content .form-group label {
            color: #a0b0d0;
            font-size: 0.9em;
        }

        .admin-panel-content .form-group input {
            background-color: #303050;
            border: 1px solid #404060;
            color: #e0e0e0;
            width: calc(100% - 22px); /* Adjust for padding and border */
            padding: 10px;
            border-radius: 4px;
        }

        .admin-panel-content .form-buttons {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 20px;
            border-top: none; /* Remove top border if it's already there */
            padding-top: 0; /* Remove top padding if it's already there */
        }

        .admin-panel-content .form-buttons button {
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 500;
        }

        .close-button {
            position: absolute;
            top: 15px;
            right: 25px;
            color: #aaa;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            transition: 0.3s;
        }

        .close-button:hover,
        .close-button:focus {
            color: #fff;
            text-decoration: none;
            cursor: pointer;
        }

        /* Existing User List in Admin Panel */
        #existingLoginsList {
            list-style: none;
            padding: 0;
            margin-top: 20px;
            max-height: 200px; /* Limit height and add scroll */
            overflow-y: auto;
            border: 1px solid #303050;
            border-radius: 4px;
            background-color: #2a2a4a;
        }

        #existingLoginsList li {
            padding: 10px 15px;
            border-bottom: 1px solid #3a3a7a;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        #existingLoginsList li:last-child {
            border-bottom: none;
        }

        #existingLoginsList li span {
            color: #e0e0e0;
            font-size: 0.9em;
        }

        #existingLoginsList li .delete-login-btn {
            background-color: #e35d6a;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 0.8em;
            transition: background-color 0.2s ease;
        }

        #existingLoginsList li .delete-login-btn:hover {
            background-color: #cc4d5b;
        }

        /* Fade-in animation for CAD */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* Slide-in animation for modal */
        @keyframes slideIn {
            from { transform: translateY(-50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

    </style>
</head>
<body>
    <div id="loginContainer" style="
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: #1a1a2e; /* Match body background */
        color: #e0e0e0;
        display: flex; /* Hidden by JS initially */
        justify-content: center;
        align-items: center;
        z-index: 2001; /* Higher than loading overlay */
    ">
        <div class="login-box" style="
            background-color: #20203a;
            padding: 40px;
            border-radius: 8px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.4);
            text-align: center;
            width: 350px;
        ">
            <h2 style="color: #ffcc00; margin-bottom: 25px;">CAD System Login</h2>
            <div class="form-group" style="margin-bottom: 20px; text-align: left;">
                <label for="usernameInput" style="display: block; margin-bottom: 8px; font-size: 0.9em; color: #90a0c0;">USERNAME</label>
                <input type="text" id="usernameInput" placeholder="Enter username" style="
                    width: calc(100% - 20px);
                    padding: 12px 10px;
                    background-color: #303050;
                    border: 1px solid #404060;
                    border-radius: 4px;
                    color: #e0e0e0;
                    font-size: 1em;
                ">
            </div>
            <div class="form-group" style="margin-bottom: 25px; text-align: left;">
                <label for="passwordInput" style="display: block; margin-bottom: 8px; font-size: 0.9em; color: #90a0c0;">PASSWORD</label>
                <input type="password" id="passwordInput" placeholder="Enter password" style="
                    width: calc(100% - 20px);
                    padding: 12px 10px;
                    background-color: #303050;
                    border: 1px solid #404060;
                    border-radius: 4px;
                    color: #e0e0e0;
                    font-size: 1em;
                ">
            </div>
            <button id="loginButton" style="
                width: 100%;
                padding: 12px 20px;
                background-color: #007bff;
                color: white;
                border: none;
                border-radius: 4px;
                cursor: pointer;
                font-size: 1.1em;
                font-weight: 500;
                transition: background-color 0.2s ease;
            ">LOGIN</button>
            <div id="loginMessage" style="color: #e35d6a; margin-top: 15px; font-size: 0.9em;"></div>
        </div>
    </div>

    <div id="adminPanelModal">
        <div class="admin-panel-content">
            <span class="close-button" id="closeAdminPanel">&times;</span>
            <h2>Admin Panel: Manage Logins</h2>

            <div class="add-login-section">
                <div class="section-title">
                    <span>ADD NEW LOGIN</span>
                </div>
                <div class="form-group">
                    <label for="newCallsignInput">CALLSIGN</label>
                    <input type="text" id="newCallsignInput" placeholder="Enter new callsign">
                </div>
                <div class="form-group">
                    <label for="newLoginPasswordInput">PASSWORD</label>
                    <input type="password" id="newLoginPasswordInput" placeholder="Enter new password">
                </div>
                <div class="form-buttons">
                    <button class="btn-primary" id="submitNewLogin">SUBMIT</button>
                </div>
            </div>

            <div class="existing-logins-section">
                <div class="section-title">
                    <span>EXISTING LOGINS</span>
                </div>
                <ul id="existingLoginsList">
                    </ul>
            </div>
        </div>
    </div>


    <div id="loadingOverlay">
        Loading Data...
    </div>

    <img src="https://media.discordapp.net/attachments/1228141326965411920/1320980715629711381/ca7eeba99227fd35efd8e37416a1680b_1.png?ex=686809e9&is=6866b869&hm=641822dd533a74995556d7f9dc2c6bd76ea3b78266177957ddda38b68cc57f56&=&format=webp&quality=lossless" alt="Logo" class="top-left-logo">
    
    <div class="top-right-info">
        <span class="top-right-version">0.0.5V</span>
        <span class="top-right-countdown" id="updateCountdownDisplay">Update 0.0.7V: Loading...</span>
    </div>

    <div id="menuBar">
        <button id="adminPanelButton">Admin Panel</button>
    </div>

    <div class="dashboard-container">
        <div class="top-section">
            <div class="top-panel-left">
                <div class="panel-header">
                    <span>ACTIVE CALLS (<span id="activeCallsCount">0</span>)</span>
                    <span class="text-muted">FILTERS</span>
                </div>
                <div class="panel-content">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>TYPE</th>
                                <th>PRIORITY</th>
                                <th>ADDRESS</th>
                                <th>NOTES</th>
                                <th>TIME</th>
                                <th>UNIT</th>
                            </tr>
                        </thead>
                        <tbody id="activeCallsTableBody">
                            </tbody>
                    </table>
                </div>
            </div>

            <div class="top-panel-middle">
                <div class="panel-header">
                    <span>ACTIVE UNITS</span>
                </div>
                <div class="panel-content unit-list" id="activeUnitsList">
                    </div>
            </div>

            <div class="top-panel-right">
                <div class="panel-header">
                    <span>ACTIVE BOLOS (<span id="activeBolosCount">0</span>)</span>
                </div>
                <div class="panel-content bolo-list" id="activeBolosList">
                    </div>
            </div>
        </div>

        <div class="bottom-section">
            <div class="bottom-panel-left">
                <div class="new-event-section">
                    <div class="section-title">
                        <span>NEW CALL</span>
                    </div>
                    <div class="form-group">
                        <label for="newCallType">EVENT TYPE</label>
                        <select id="newCallType">
                            <option value="">SELECT</option>
                            <option value="MEDICAL">MEDICAL</option>
                            <option value="FIRE">FIRE</option>
                            <option value="POLICE">POLICE</option>
                            <option value="RADIO TRAFFIC">RADIO TRAFFIC</option> <option value="OTHER">OTHER</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="newCallAddress">ADDRESS</label>
                        <input type="text" id="newCallAddress" placeholder="Enter address...">
                    </div>
                    <div class="form-group">
                        <label for="newCallDetails">DETAILS</label>
                        <textarea id="newCallDetails" placeholder="Provide event details..."></textarea>
                    </div>
                    <div class="form-group">
                        <label for="newCallPriority">PRIORITY</label>
                        <select id="newCallPriority">
                            <option value="LOW">LOW</option>
                            <option value="MEDIUM">MEDIUM</option>
                            <option value="HIGH">HIGH</option>
                            <option value="CRITICAL">CRITICAL</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="newCallAssignedUnit">ASSIGN TO UNIT</label>
                        <input type="text" id="newCallAssignedUnit" placeholder="Unit ID or search...">
                    </div>
                    <div class="form-buttons">
                        <button class="btn-primary" id="submitNewCall">SUBMIT CALL</button>
                        <button class="btn-secondary" id="clearNewCallForm">CLEAR FORM</button>
                    </div>
                </div>

                <div class="unit-status-update-section">
                    <div class="section-title">
                        <span>UNIT STATUS UPDATE</span>
                    </div>
                    <div class="form-group">
                        <label for="unitCallsignInput">UNIT CALLSIGN</label>
                        <input type="text" id="unitCallsignInput" placeholder="e.g., E101, P205">
                    </div>
                    <div class="form-group">
                        <label for="unitStatusSelect">STATUS</label>
                        <select id="unitStatusSelect">
                            <option value="">SELECT STATUS</option>
                            <option value="10-6 Busy">10-6 Busy</option>
                            <option value="10-7 Out of Service">10-7 Out of Service</option>
                            <option value="10-8 In Service">10-8 In Service</option>
                        </select>
                    </div>
                    <div class="form-buttons">
                        <button class="btn-primary" id="updateUnitStatus">UPDATE STATUS</button>
                    </div>
                </div>

                <div class="new-bolo-section">
                    <div class="section-title">
                        <span>NEW BOLO</span>
                    </div>
                    <div class="form-group">
                        <label for="boloUnitCallsign">UNIT/BOLO ID</label>
                        <input type="text" id="boloUnitCallsign" placeholder="e.g., Car, Person, Unit A1">
                    </div>
                    <div class="form-group">
                        <label for="boloDescription">DESCRIPTION</label>
                        <textarea id="boloDescription" placeholder="Detailed description of BOLO..."></textarea>
                    </div>
                    <div class="form-buttons">
                        <button class="btn-primary" id="submitNewBolo">SUBMIT BOLO</button>
                        <button class="btn-secondary" id="clearNewBoloForm">CLEAR FORM</button>
                    }
                </div>

                <div class="system-controls-section">
                    <div class="section-title">
                        <span>SYSTEM CONTROLS</span>
                    </div>
                    <div class="form-buttons">
                        <button class="btn-primary" id="clearAllButton">CLEAR ALL LOGS</button>
                        <button class="btn-secondary" id="logoutButton">LOGOUT</button>
                    </div>
                </div>
            </div>

            <div class="bottom-panel-right">
                <div class="panel-header">
                    <span id="eventDetailHeader">Event Details</span>
                </div>
                <div class="detail-item">
                    <span class="detail-label">INCIDENT TYPE</span>
                    <span class="detail-value" id="eventDetailType">N/A</span>
                </div>
                <div class="detail-item">
                    <span class="detail-label">LOCATION</span>
                    <span class="detail-value" id="eventDetailLocation">N/A</span>
                </div>
                <div class="detail-item">
                    <span class="detail-label">CALLER INFO</span>
                    <span class="detail-value" id="eventDetailCaller">N/A</span>
                </div>
                <div class="detail-item">
                    <span class="detail-label">STATUS</span>
                    <span class="detail-value"><span class="status-badge red" id="eventDetailStatus">N/A</span></span>
                </div>
                <div class="detail-item">
                    <span class="detail-label">ASSIGNED UNIT(S)</span>
                    <span class="detail-value" id="eventDetailAssignedUnits">N/A</span>
                </div>
                <div class="detail-item">
                    <span class="detail-label">PRIORITY</span>
                    <span class="detail-value important" id="eventDetailPriority">N/A</span>
                </div>
                <div class="detail-item">
                    <span class="detail-label">TIME OPENED</span>
                    <span class="detail-value" id="eventDetailTimeOpened">N/A</span>
                </div>
                <div class="detail-item">
                    <span class="detail-label">NOTES</span>
                    <span class="detail-value" id="eventDetailNotes">N/A</span>
                </div>
                <div class="detail-item">
                    <span class="detail-label">LAST UPDATE</span>
                    <span class="detail-value" id="eventDetailLastUpdate">N/A</span>
                </div>
            </div>
        </div>
    </div>

    <div id="customContextMenu">
        <div class="menu-item" id="contextAssignUnit">Assign Unit</div>
        <div class="menu-item" id="contextUpdateStatus">Update Status</div>
        <div class="menu-item" id="contextCloseCall">Close Call</div>
    </div>

    <script>
        // --- Utility Functions for Fading ---
        function fadeOut(element, callback) {
            let opacity = 1;
            const timer = setInterval(function() {
                if (opacity <= 0.05) {
                    clearInterval(timer);
                    element.style.display = 'none';
                    element.style.opacity = 0; // Ensure it's fully transparent when hidden
                    if (callback) callback();
                }
                element.style.opacity = opacity;
                opacity -= 0.05;
            }, 20); // Faster fade for smoother feel
        }

        function fadeIn(element, displayType = 'flex', callback) {
            let opacity = 0;
            element.style.opacity = 0; // Start completely transparent
            element.style.display = displayType;
            const timer = setInterval(function() {
                if (opacity >= 1) {
                    clearInterval(timer);
                    if (callback) callback();
                }
                element.style.opacity = opacity;
                opacity += 0.05;
            }, 20); // Faster fade
        }

        // --- DOM Elements ---
        const loginContainer = document.getElementById('loginContainer');
        const usernameInput = document.getElementById('usernameInput');
        const passwordInput = document.getElementById('passwordInput');
        const loginButton = document.getElementById('loginButton');
        const loginMessage = document.getElementById('loginMessage');

        const dashboardContainer = document.querySelector('.dashboard-container');
        const topLeftLogo = document.querySelector('.top-left-logo');
        const topRightInfo = document.querySelector('.top-right-info');
        const menuBar = document.getElementById('menuBar');
        const loadingOverlay = document.getElementById('loadingOverlay');

        const adminPanelButton = document.getElementById('adminPanelButton');
        const adminPanelModal = document.getElementById('adminPanelModal');
        const closeAdminPanel = document.getElementById('closeAdminPanel');
        const newCallsignInput = document.getElementById('newCallsignInput');
        const newLoginPasswordInput = document.getElementById('newLoginPasswordInput');
        const submitNewLogin = document.getElementById('submitNewLogin');
        const existingLoginsList = document.getElementById('existingLoginsList');
        const logoutButton = document.getElementById('logoutButton');

        // --- Login Logic ---
        const ADMIN_USERNAME = "admin";
        const ADMIN_PASSWORD = "BCDCADMIN25"; // Insecure: For client-side demo only!

        // Placeholder for "user" logins (callsigns/passwords) - in a real app, this would be server-side and hashed
        let currentLogins = [];
        if (localStorage.getItem('userLogins')) {
            currentLogins = JSON.parse(localStorage.getItem('userLogins'));
        }

        function saveLogins() {
            localStorage.setItem('userLogins', JSON.stringify(currentLogins));
        }

        function renderExistingLogins() {
            existingLoginsList.innerHTML = '';
            currentLogins.forEach((login, index) => {
                const li = document.createElement('li');
                li.innerHTML = `
                    <span>Callsign: ${login.callsign}</span>
                    <button class="delete-login-btn" data-index="${index}">Delete</button>
                `;
                existingLoginsList.appendChild(li);
            });

            document.querySelectorAll('.delete-login-btn').forEach(button => {
                button.onclick = function() {
                    const index = parseInt(this.dataset.index);
                    currentLogins.splice(index, 1);
                    saveLogins();
                    renderExistingLogins();
                };
            });
        }

        loginButton.addEventListener('click', () => {
            const username = usernameInput.value;
            const password = passwordInput.value;

            loginMessage.textContent = ""; // Clear previous messages

            if (username === ADMIN_USERNAME && password === ADMIN_PASSWORD) {
                // Admin login
                showDashboard();
            } else {
                // Check against regular logins
                const userLogin = currentLogins.find(login => login.callsign === username && login.password === password);
                if (userLogin) {
                    showDashboard();
                } else {
                    loginMessage.textContent = "Invalid username or password.";
                }
            }
        });

        function showDashboard() {
            fadeOut(loadingOverlay, () => {
                fadeOut(loginContainer, () => {
                    // Show dashboard elements with a fade-in effect
                    fadeIn(topLeftLogo, 'block');
                    fadeIn(topRightInfo, 'flex');
                    fadeIn(menuBar, 'flex');
                    fadeIn(dashboardContainer, 'flex');
                    // Ensure the initial display properties are set after login
                    dashboardContainer.style.display = 'flex';
                    topLeftLogo.style.display = 'block';
                    topRightInfo.style.display = 'flex';
                    menuBar.style.display = 'flex';
                });
            });
        }

        // --- Admin Panel Logic ---
        adminPanelButton.addEventListener('click', () => {
            fadeIn(adminPanelModal, 'flex'); // Show the modal
            renderExistingLogins(); // Render current logins when modal opens
        });

        closeAdminPanel.addEventListener('click', () => {
            fadeOut(adminPanelModal); // Hide the modal
        });

        submitNewLogin.addEventListener('click', () => {
            const newCallsign = newCallsignInput.value.trim();
            const newPassword = newLoginPasswordInput.value.trim();

            if (newCallsign && newPassword) {
                if (currentLogins.some(login => login.callsign === newCallsign)) {
                    alert('Callsign already exists!');
                } else {
                    currentLogins.push({ callsign: newCallsign, password: newPassword });
                    saveLogins();
                    renderExistingLogins();
                    newCallsignInput.value = '';
                    newLoginPasswordInput.value = '';
                    alert('New login added successfully!');
                }
            } else {
                alert('Please enter both callsign and password.');
            }
        });

        logoutButton.addEventListener('click', () => {
            // Hide dashboard elements and show login screen
            fadeOut(dashboardContainer);
            fadeOut(topLeftLogo);
            fadeOut(topRightInfo);
            fadeOut(menuBar, () => {
                fadeIn(loginContainer, 'flex');
                usernameInput.value = ''; // Clear login fields
                passwordInput.value = '';
                loginMessage.textContent = '';
            });
        });


        // --- Initial Load Logic ---
        document.addEventListener('DOMContentLoaded', () => {
            // Hide dashboard elements initially, only show login
            dashboardContainer.style.display = 'none';
            topLeftLogo.style.display = 'none';
            topRightInfo.style.display = 'none';
            menuBar.style.display = 'none';

            // Start with loading overlay, then fade to login
            fadeIn(loadingOverlay, 'flex', () => {
                setTimeout(() => {
                    fadeOut(loadingOverlay, () => {
                        fadeIn(loginContainer, 'flex'); // Ensure login is displayed as flex
                    });
                }, 1000); // Simulate loading time
            });
        });


        // --- Dummy Data and Dashboard Functionality (from your original code, adapted) ---
        // Dummy Data - For demonstration purposes
        let activeCalls = [
            { id: 1, type: 'MEDICAL', priority: 'HIGH', address: '123 Main St', notes: 'Elderly fall, possible hip fracture', time: '10:00', unit: 'E101' },
            { id: 2, type: 'POLICE', priority: 'MEDIUM', address: '456 Oak Ave', notes: 'Suspicious vehicle, dark sedan', time: '10:15', unit: 'P205' },
            { id: 3, type: 'FIRE', priority: 'CRITICAL', address: '789 Pine Rd', notes: 'Structure fire, heavy smoke', time: '10:30', unit: 'F302' },
        ];

        let activeUnits = [
            { id: 'E101', status: '10-6 Busy', assignedCall: 1 },
            { id: 'P205', status: '10-6 Busy', assignedCall: 2 },
            { id: 'F302', status: '10-6 Busy', assignedCall: 3 },
            { id: 'P201', status: '10-8 In Service', assignedCall: null },
            { id: 'E102', status: '10-7 Out of Service', assignedCall: null }
        ];

        let activeBolos = [
            { id: 'VEHICLE-123', description: 'Blue Honda Civic, FL Tag ABC123, wanted for shoplifting.', time: '09:45' },
            { id: 'PERSON-A', description: 'Male, 30s, wearing red hoodie, last seen near park, possible runaway.', time: '11:00' }
        ];

        let nextCallId = 4; // To assign unique IDs to new calls
        let selectedCall = null; // To store the currently selected call for detail view

        // Function to render active calls table
        function renderActiveCalls() {
            const tableBody = document.getElementById('activeCallsTableBody');
            tableBody.innerHTML = ''; // Clear existing rows
            activeCalls.forEach(call => {
                const row = tableBody.insertRow();
                row.dataset.callId = call.id; // Store call ID on the row for easy lookup
                row.innerHTML = `
                    <td>${call.id}</td>
                    <td>${call.type}</td>
                    <td>${call.priority}</td>
                    <td>${call.address}</td>
                    <td>${call.notes}</td>
                    <td>${call.time}</td>
                    <td>${call.unit || 'N/A'}</td>
                `;
                row.addEventListener('click', () => selectCall(call.id));
            });
            document.getElementById('activeCallsCount').textContent = activeCalls.length;
        }

        // Function to render active units list
        function renderActiveUnits() {
            const unitList = document.getElementById('activeUnitsList');
            unitList.innerHTML = '';
            activeUnits.forEach(unit => {
                const unitDiv = document.createElement('div');
                unitDiv.className = 'unit-item';
                unitDiv.dataset.unitId = unit.id;
                unitDiv.innerHTML = `<span class="unit-id">${unit.id}</span> - ${unit.status}`;
                if (unit.assignedCall) {
                    unitDiv.innerHTML += ` (Call #${unit.assignedCall})`;
                }
                unitDiv.addEventListener('click', () => selectUnit(unit.id));
                unitList.appendChild(unitDiv);
            });
        }

        // Function to render active BOLOs list
        function renderActiveBolos() {
            const boloList = document.getElementById('activeBolosList');
            boloList.innerHTML = '';
            activeBolos.forEach(bolo => {
                const boloDiv = document.createElement('div');
                boloDiv.className = 'bolo-item';
                boloDiv.innerHTML = `
                    <span class="bolo-id">${bolo.id}</span> - ${bolo.description}
                    <span class="bolo-time">(${bolo.time})</span>
                `;
                boloList.appendChild(boloDiv);
            });
            document.getElementById('activeBolosCount').textContent = activeBolos.length;
        }

        // Function to display call details in the bottom-panel-right
        function displayCallDetails(call) {
            document.getElementById('eventDetailHeader').textContent = `Event Details (Call #${call.id})`;
            document.getElementById('eventDetailType').textContent = call.type;
            document.getElementById('eventDetailLocation').textContent = call.address;
            document.getElementById('eventDetailCaller').textContent = call.callerInfo || 'N/A';
            document.getElementById('eventDetailAssignedUnits').textContent = call.unit || 'N/A';
            document.getElementById('eventDetailPriority').textContent = call.priority;
            document.getElementById('eventDetailTimeOpened').textContent = call.time;
            document.getElementById('eventDetailNotes').textContent = call.notes;
            document.getElementById('eventDetailLastUpdate').textContent = new Date().toLocaleTimeString(); // Current time for last update

            const statusBadge = document.getElementById('eventDetailStatus');
            statusBadge.textContent = call.status || 'NEW';
            statusBadge.className = 'status-badge'; // Reset classes
            if (call.status === 'CLOSED') {
                statusBadge.classList.add('green');
            } else if (call.status === 'ENROUTE' || call.status === 'ON SCENE') {
                statusBadge.classList.add('blue');
            } else {
                statusBadge.classList.add('red'); // Default to red for new/pending
            }
        }

        // Function to select a call from the table
        function selectCall(callId) {
            // Remove 'active-row' class from all rows
            document.querySelectorAll('#activeCallsTableBody tr').forEach(row => {
                row.classList.remove('active-row');
            });

            // Add 'active-row' to the selected row
            const selectedRow = document.querySelector(`#activeCallsTableBody tr[data-call-id="${callId}"]`);
            if (selectedRow) {
                selectedRow.classList.add('active-row');
            }

            selectedCall = activeCalls.find(call => call.id === callId);
            if (selectedCall) {
                displayCallDetails(selectedCall);
            }
        }

        // Dummy function for selecting a unit (e.g., to highlight it or show its details)
        function selectUnit(unitId) {
            document.querySelectorAll('.unit-item').forEach(item => item.classList.remove('active'));
            const selectedUnitElement = document.querySelector(`.unit-item[data-unit-id="${unitId}"]`);
            if (selectedUnitElement) {
                selectedUnitElement.classList.add('active');
            }
            // You could display unit details here similarly to calls
            console.log(`Unit ${unitId} selected.`);
        }

        // --- Form Submission Logic ---
        document.getElementById('submitNewCall').addEventListener('click', () => {
            const type = document.getElementById('newCallType').value;
            const address = document.getElementById('newCallAddress').value.trim();
            const details = document.getElementById('newCallDetails').value.trim();
            const priority = document.getElementById('newCallPriority').value;
            const assignedUnit = document.getElementById('newCallAssignedUnit').value.trim();

            if (!type || !address || !details || !priority) {
                alert('Please fill in all new call fields!');
                return;
            }

            const newCall = {
                id: nextCallId++,
                type: type,
                priority: priority,
                address: address,
                notes: details,
                time: new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }),
                unit: assignedUnit || null,
                status: 'NEW' // Default status
            };
            activeCalls.push(newCall);
            renderActiveCalls();
            displayCallDetails(newCall); // Show details of the newly created call
            document.getElementById('clearNewCallForm').click(); // Clear form
        });

        document.getElementById('clearNewCallForm').addEventListener('click', () => {
            document.getElementById('newCallType').value = '';
            document.getElementById('newCallAddress').value = '';
            document.getElementById('newCallDetails').value = '';
            document.getElementById('newCallPriority').value = 'LOW';
            document.getElementById('newCallAssignedUnit').value = '';
        });

        document.getElementById('updateUnitStatus').addEventListener('click', () => {
            const unitCallsign = document.getElementById('unitCallsignInput').value.trim().toUpperCase();
            const unitStatus = document.getElementById('unitStatusSelect').value;

            if (!unitCallsign || !unitStatus) {
                alert('Please enter unit callsign and select a status.');
                return;
            }

            const unitIndex = activeUnits.findIndex(unit => unit.id === unitCallsign);
            if (unitIndex !== -1) {
                activeUnits[unitIndex].status = unitStatus;
                alert(`Unit ${unitCallsign} status updated to: ${unitStatus}`);
                renderActiveUnits();
            } else {
                // If unit doesn't exist, add it
                activeUnits.push({ id: unitCallsign, status: unitStatus, assignedCall: null });
                alert(`New unit ${unitCallsign} added with status: ${unitStatus}`);
                renderActiveUnits();
            }
            document.getElementById('unitCallsignInput').value = '';
            document.getElementById('unitStatusSelect').value = '';
        });

        document.getElementById('submitNewBolo').addEventListener('click', () => {
            const boloId = document.getElementById('boloUnitCallsign').value.trim().toUpperCase();
            const boloDescription = document.getElementById('boloDescription').value.trim();

            if (!boloId || !boloDescription) {
                alert('Please enter BOLO ID and description.');
                return;
            }

            const newBolo = {
                id: boloId,
                description: boloDescription,
                time: new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })
            };
            activeBolos.push(newBolo);
            renderActiveBolos();
            document.getElementById('clearNewBoloForm').click(); // Clear form
        });

        document.getElementById('clearNewBoloForm').addEventListener('click', () => {
            document.getElementById('boloUnitCallsign').value = '';
            document.getElementById('boloDescription').value = '';
        });

        document.getElementById('clearAllButton').addEventListener('click', () => {
            if (confirm('Are you sure you want to clear all active calls, units, and BOLOs? This cannot be undone.')) {
                activeCalls = [];
                activeUnits = [];
                activeBolos = [];
                nextCallId = 1; // Reset call ID counter
                renderActiveCalls();
                renderActiveUnits();
                renderActiveBolos();
                displayCallDetails({}); // Clear details panel
                alert('All logs cleared!');
            }
        });

        // --- Context Menu Logic ---
        const customContextMenu = document.getElementById('customContextMenu');
        let rightClickedCallId = null;

        document.getElementById('activeCallsTableBody').addEventListener('contextmenu', function(e) {
            e.preventDefault(); // Prevent default browser context menu

            const targetRow = e.target.closest('tr');
            if (targetRow && targetRow.dataset.callId) {
                rightClickedCallId = parseInt(targetRow.dataset.callId);

                // Position the custom context menu
                customContextMenu.style.top = `${e.clientY}px`;
                customContextMenu.style.left = `${e.clientX}px`;
                fadeIn(customContextMenu, 'block'); // Show it
            }
        });

        // Hide context menu if clicked anywhere else
        document.addEventListener('click', function() {
            fadeOut(customContextMenu);
        });

        // Context menu actions
        document.getElementById('contextAssignUnit').addEventListener('click', function() {
            if (rightClickedCallId !== null) {
                const unit = prompt('Enter unit ID to assign (e.g., P201):');
                if (unit) {
                    const call = activeCalls.find(c => c.id === rightClickedCallId);
                    if (call) {
                        call.unit = unit.toUpperCase();
                        call.status = 'ASSIGNED';
                        const assignedUnit = activeUnits.find(u => u.id === unit.toUpperCase());
                        if (assignedUnit) {
                            assignedUnit.assignedCall = call.id;
                            assignedUnit.status = '10-6 Busy'; // Update unit status if it exists
                        } else {
                            activeUnits.push({ id: unit.toUpperCase(), status: '10-6 Busy', assignedCall: call.id });
                        }
                        renderActiveCalls();
                        renderActiveUnits();
                        displayCallDetails(call); // Update details panel
                        alert(`Call #${rightClickedCallId} assigned to ${unit.toUpperCase()}.`);
                    }
                }
            }
        });

        document.getElementById('contextUpdateStatus').addEventListener('click', function() {
            if (rightClickedCallId !== null) {
                const newStatus = prompt('Enter new status for call (e.g., ENROUTE, ON SCENE, CLOSED):');
                if (newStatus) {
                    const call = activeCalls.find(c => c.id === rightClickedCallId);
                    if (call) {
                        call.status = newStatus.toUpperCase();
                        renderActiveCalls(); // Re-render to update status display if needed
                        displayCallDetails(call); // Update details panel
                        alert(`Call #${rightClickedCallId} status updated to ${newStatus.toUpperCase()}.`);
                    }
                }
            }
        });

        document.getElementById('contextCloseCall').addEventListener('click', function() {
            if (rightClickedCallId !== null) {
                if (confirm(`Are you sure you want to close Call #${rightClickedCallId}?`)) {
                    activeCalls = activeCalls.filter(call => call.id !== rightClickedCallId);
                    // Also update units that were assigned to this call
                    activeUnits.forEach(unit => {
                        if (unit.assignedCall === rightClickedCallId) {
                            unit.assignedCall = null;
                            unit.status = '10-8 In Service'; // Unit becomes available
                        }
                    });
                    renderActiveCalls();
                    renderActiveUnits();
                    displayCallDetails({}); // Clear details panel
                    alert(`Call #${rightClickedCallId} closed.`);
                }
            }
        });

        // Initial rendering of data when the dashboard is shown
        // These will be called by `showDashboard` after login
        // renderActiveCalls();
        // renderActiveUnits();
        // renderActiveBolos();

        // Placeholder for update countdown (you can implement actual countdown logic here)
        function updateCountdown() {
            // Example: A simple countdown to a fictional update
            const targetDate = new Date('2025-07-06T00:00:00'); // Example: July 6th, 2025
            const now = new Date();
            const timeLeft = targetDate.getTime() - now.getTime();

            if (timeLeft <= 0) {
                document.getElementById('updateCountdownDisplay').textContent = "Update 0.0.7V: Available!";
                return;
            }

            const days = Math.floor(timeLeft / (1000 * 60 * 60 * 24));
            const hours = Math.floor((timeLeft % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((timeLeft % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((timeLeft % (1000 * 60)) / 1000);

            document.getElementById('updateCountdownDisplay').textContent = `Update 0.0.7V: ${days}d ${hours}h ${minutes}m ${seconds}s`;
        }

        // Update countdown every second
        setInterval(updateCountdown, 1000);
        updateCountdown(); // Call immediately to set initial display
    </script>
</body>
</html>
